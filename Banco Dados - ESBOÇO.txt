CREATE TABLE USUARIOS (
    ID_USUARIO SERIAL PRIMARY KEY,
    NOME VARCHAR(150) NOT NULL,
    EMAIL VARCHAR(150) NOT NULL UNIQUE,
    SENHA VARCHAR(255) NOT NULL, 
    FOTO_PERFIL TEXT, 
    DATA_ULTIMO_LOGIN TIMESTAMP WITHOUT TIME ZONE,
    DATA_ULTIMA_REVISAO_GERAL DATE
);

CREATE TABLE DESPESAS (
    ID_DESPESA SERIAL PRIMARY KEY,
    NOME VARCHAR(150) NOT NULL,
    VALOR_TOTAL NUMERIC(10, 2) NOT NULL CHECK (VALOR_TOTAL > 0),
    DATA_DESPESA DATE NOT NULL DEFAULT CURRENT_DATE,
    TIPO_DESPESA VARCHAR(20) NOT NULL CHECK (TIPO_DESPESA IN ('FIXA', 'ADICIONAL')),
    TIPO_TRANSACAO VARCHAR(20) NOT NULL CHECK (TIPO_TRANSACAO IN ('CREDITO', 'DEBITO')),
    PARCELAS_TOTAIS INTEGER,
    DATA_PRIMEIRA_PARCELA DATE,
    FK_ID_USUARIO INTEGER NOT NULL REFERENCES USUARIOS(ID_USUARIO) ON DELETE CASCADE,
    FK_ID_CATEGORIA INTEGER NOT NULL REFERENCES CATEGORIAS(ID_CATEGORIA) ON DELETE RESTRICT,
    FK_ID_FORMA_PAGAMENTO INTEGER NOT NULL REFERENCES FORMA_PAGAMENTO(ID_FORMA_PAGAMENTO) ON DELETE RESTRICT
);

# Quando for dinheiro o tipo_transacao já seta para debito, 
# porem quando for cartão ou pix vai ser preciso informar se foi credito ou debito, 
# se for credito o usuario precisa informar parcelas_totais na tabela despesas.

CREATE TABLE CATEGORIAS (
    ID_CATEGORIA SERIAL PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    DESCRICAO TEXT
);

CREATE TABLE FORMA_PAGAMENTO (
    ID_FORMA_PAGAMENTO SERIAL PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL UNIQUE -- 'CARTÃO', 'DINHEIRO', 'PIX'
);

SELECT SUM(valor_total) 
FROM despesas 
WHERE fk_id_usuario = [ID_DO_USUÁRIO] 
  AND EXTRACT(MONTH FROM data_despesa) = 12 
  AND EXTRACT(YEAR FROM data_despesa) = 2025;